import requests

URL = "http://10.3.6.31:9082/WS14_414_040G/services/wapiOtherSoapHttpPort"
SOAP_ACTION = "http://wapiOther/WapiOther.wsdl/getserviceinfoother"

HEADERS_TEMPLATE = lambda instance_no: {
    "Content-Type": "text/xml; charset=UTF-8",
    "SOAPAction": SOAP_ACTION,
    "instanceNo": instance_no
}

# Wczytaj listę instanceNo z pliku
with open("lista.txt", "r") as f:
    instances = [line.strip() for line in f if line.strip()]

# Wczytaj szablon XML z pliku
with open("soap_request3.xml", "r", encoding="utf-8") as f:
    soap_template = f.read()

# Iteracja po każdej instancji
for instance_no in instances:
    headers = HEADERS_TEMPLATE(instance_no)
    body = soap_template.replace("{instance_no}", instance_no)

    try:
        response = requests.post(URL, data=body, headers=headers, verify=False)
        filename = f"response_{instance_no}.xml"

        with open(filename, "w", encoding="utf-8") as out:
            out.write(response.text)

        print(f"{instance_no} → OK ({response.status_code})")

    except Exception as ex:
        print(f"{instance_no} → ERROR: {ex}")